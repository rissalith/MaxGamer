# FrameWorker 开发部署工作流程

## 📋 推荐工作流程

### 方案一：本地测试 + 服务器部署（推荐）✅

这是最安全和专业的方式：

#### 1. 本地开发和测试
```bash
# 启动本地后端（在 backend 目录）
cd backend
start.bat

# 在浏览器打开前端
# 直接打开 frontend/index.html
```

#### 2. 本地测试通过后提交代码
```bash
git add .
git commit -m "feat: 添加新功能"
git push origin main
```

#### 3. 部署到服务器（一键部署）
```bash
# 使用快速部署脚本
deploy-final.bat
```

**优点**：
- ✅ 安全：本地测试通过才部署，避免线上出错
- ✅ 快速：发现问题可以立即在本地修复
- ✅ 专业：符合标准开发流程
- ✅ 可回滚：Git记录完整，可随时回退

---

### 方案二：直接服务器开发（不推荐）⚠️

直接在服务器上修改代码：

```bash
# SSH登录服务器
plink -batch -pw pXw1995 root@149.88.69.87

# 编辑文件
cd /var/www/xmframer
nano backend/app.py

# 重启服务
systemctl restart frameworker
```

**缺点**：
- ❌ 危险：直接修改线上代码，出错影响用户
- ❌ 难调试：服务器环境调试困难
- ❌ 无版本控制：修改可能丢失
- ❌ 不专业：不符合开发规范

---

## 🚀 快速部署命令

### 完整部署（首次或大更新）
```bash
deploy-final.bat
```
包含：上传代码 + 安装依赖 + 重启服务

### 快速更新（小改动）
```bash
# 只更新代码并重启
plink -batch -pw pXw1995 root@149.88.69.87 "cd /var/www/xmframer && git pull && systemctl restart frameworker"
```

### 紧急修复
```bash
fix-server.bat
```
快速诊断和修复常见问题

### 完整诊断
```bash
diagnose-and-fix.bat
```
全面检查系统状态并自动修复

---

## 📦 是否需要发版？

### 当前项目：**不需要传统意义的发版**

因为这是一个Web应用，不是软件包，所以：

#### ✅ 你需要做的：
1. **Git提交**：记录代码变更
   ```bash
   git add .
   git commit -m "版本说明"
   git tag v1.0.1  # 可选：打标签标记版本
   git push origin main --tags
   ```

2. **部署到服务器**：让用户看到更新
   ```bash
   deploy-final.bat
   ```

#### ❌ 你不需要做的：
- 不需要编译打包（Python是解释型语言）
- 不需要发布到应用商店
- 不需要用户手动更新（Web应用自动更新）

---

## 🔄 版本管理建议

### 使用Git标签管理版本

```bash
# 标记新版本
git tag -a v1.0.0 -m "初始版本"
git tag -a v1.1.0 -m "添加帧插值功能"
git tag -a v1.2.0 -m "添加历史记录功能"

# 推送标签
git push origin --tags

# 查看所有版本
git tag -l

# 回退到某个版本
git checkout v1.0.0
```

### 版本号规范（语义化版本）

格式：`v主版本.次版本.修订号`

- **主版本**（1.x.x）：重大功能变更或不兼容更新
- **次版本**（x.1.x）：新增功能，向后兼容
- **修订号**（x.x.1）：Bug修复，小改进

示例：
- `v1.0.0` - 初始发布
- `v1.1.0` - 添加新功能（帧插值）
- `v1.1.1` - 修复Bug
- `v2.0.0` - 重大架构调整

---

## 📝 完整开发流程示例

### 场景：添加一个新功能

```bash
# 1. 本地开发
# 修改代码...
# 启动本地测试
cd backend && start.bat

# 2. 本地测试通过

# 3. 提交代码
git add .
git commit -m "feat: 添加新的AI模型支持"
git tag v1.3.0
git push origin main --tags

# 4. 部署到服务器
deploy-final.bat

# 5. 验证线上功能
# 访问 https://www.xmframer.com 测试
```

### 场景：紧急修复Bug

```bash
# 1. 本地快速修复
# 修改代码...

# 2. 本地验证修复

# 3. 提交
git add .
git commit -m "fix: 修复生成失败的问题"
git tag v1.2.1
git push origin main --tags

# 4. 快速部署
plink -batch -pw pXw1995 root@149.88.69.87 "cd /var/www/xmframer && git pull && systemctl restart frameworker"

# 5. 验证修复
curl https://www.xmframer.com/api/health
```

---

## 🛠️ 常用命令速查

### 本地开发
```bash
# 启动后端
cd backend && start.bat

# 查看日志
# 在终端查看输出

# 停止服务
# Ctrl+C
```

### 服务器操作
```bash
# 查看服务状态
plink -batch -pw pXw1995 root@149.88.69.87 "systemctl status frameworker"

# 查看日志
plink -batch -pw pXw1995 root@149.88.69.87 "journalctl -u frameworker -f"

# 重启服务
plink -batch -pw pXw1995 root@149.88.69.87 "systemctl restart frameworker"

# 查看端口
plink -batch -pw pXw1995 root@149.88.69.87 "lsof -i:3000"
```

### Git操作
```bash
# 查看状态
git status

# 查看历史
git log --oneline

# 查看版本
git tag -l

# 回退版本
git reset --hard v1.0.0
```

---

## ⚡ 最佳实践总结

1. **永远先本地测试** - 避免线上出错
2. **使用Git管理版本** - 方便回滚和追踪
3. **写清楚commit信息** - 方便以后查找
4. **小步快跑** - 频繁提交，小改动
5. **保持备份** - 重要更新前先备份
6. **监控日志** - 部署后检查服务状态

---

## 🆘 遇到问题？

### 本地测试失败
- 检查Python环境和依赖
- 查看终端错误信息
- 检查API密钥配置

### 部署失败
```bash
# 运行诊断脚本
diagnose-and-fix.bat

# 或手动检查
plink -batch -pw pXw1995 root@149.88.69.87 "systemctl status frameworker"
```

### 服务崩溃
```bash
# 快速修复
fix-server.bat

# 查看错误日志
plink -batch -pw pXw1995 root@149.88.69.87 "journalctl -u frameworker -n 50"
```

---

## 📚 相关文档

- [`README_DEPLOY.md`](README_DEPLOY.md) - 详细部署指南
- [`快速部署指南.md`](快速部署指南.md) - 快速上手
- [`DEPLOY_PYTHON.md`](DEPLOY_PYTHON.md) - Python后端部署
- [`API_KEY_DEPLOY.md`](API_KEY_DEPLOY.md) - API密钥配置

---

**记住：本地测试 → Git提交 → 服务器部署 → 验证功能** ✅