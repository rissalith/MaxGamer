# FrameWorker 快速部署指南

## 🚀 一键部署到云服务器

### 前提条件
- ✅ 服务器 IP: 149.88.69.87
- ✅ SSH 访问权限（用户名: root）
- ✅ 服务器系统: Ubuntu 24.04

### 部署步骤

#### 1️⃣ 在本地 Windows 打开 PowerShell

在项目根目录（`c:\巫女上上签\FrameWorker`）右键选择"在终端中打开"或打开 PowerShell 并切换到项目目录。

#### 2️⃣ 执行同步脚本

```powershell
.\sync-to-server-python.ps1
```

脚本会自动：
- 测试 SSH 连接
- 上传所有代码到服务器
- 询问是否立即部署

#### 3️⃣ 选择立即部署

当脚本询问"是否立即登录服务器并执行部署？"时，输入 `y` 并回车。

脚本会自动：
- 登录服务器
- 安装 Python、Nginx 等环境
- 配置 systemd 服务
- 启动应用

#### 4️⃣ 访问应用

部署完成后，在浏览器访问：
- **前端**: http://149.88.69.87
- **API**: http://149.88.69.87/api/health

---

## 📋 手动部署（如果自动部署失败）

### 步骤 1: 上传代码

```powershell
# 在本地 PowerShell 执行
.\sync-to-server-python.ps1
```

选择 `n` 跳过自动部署。

### 步骤 2: 登录服务器

```powershell
ssh root@149.88.69.87
```

### 步骤 3: 执行部署脚本

```bash
cd /var/www/xmframer
chmod +x deploy-python.sh
./deploy-python.sh
```

按照提示完成部署。

---

## 🔑 配置 API 密钥

部署完成后，需要配置 AI API 密钥：

```bash
# 登录服务器
ssh root@149.88.69.87

# 编辑环境变量文件
nano /var/www/xmframer/backend/.env
```

确保包含以下内容：
```env
AI_IMAGE_API_KEY=your_actual_api_key_here
PROXY_URL=http://127.0.0.1:7897
```

保存后重启服务：
```bash
sudo systemctl restart frameworker
```

---

## 🔍 检查服务状态

```bash
# 查看后端服务状态
sudo systemctl status frameworker

# 查看实时日志
sudo journalctl -u frameworker -f

# 测试 API
curl http://localhost:3000/api/health
```

---

## 🔄 更新代码

当本地代码修改后：

```powershell
# 1. 在本地执行同步
.\sync-to-server-python.ps1

# 2. 登录服务器
ssh root@149.88.69.87

# 3. 重启服务
sudo systemctl restart frameworker
sudo cp -r /var/www/xmframer/frontend/* /var/www/html/xmframer/
```

---

## ❓ 常见问题

### Q: SSH 连接失败？
**A:** 检查：
1. 服务器 IP 是否正确
2. SSH 用户名是否为 root
3. 网络连接是否正常

### Q: 后端服务启动失败？
**A:** 查看日志：
```bash
sudo journalctl -u frameworker -n 50
```

常见原因：
- Python 依赖未安装
- .env 文件配置错误
- 端口 3000 被占用

### Q: 前端页面 404？
**A:** 检查文件权限：
```bash
sudo chown -R www-data:www-data /var/www/html/xmframer
sudo chmod -R 755 /var/www/html/xmframer
```

### Q: AI 图像生成失败？
**A:** 检查：
1. API 密钥是否正确配置
2. 代理设置是否正确（如果在国内）
3. 查看后端日志确认错误信息

---

## 📚 详细文档

- **完整部署文档**: [`DEPLOY_PYTHON.md`](DEPLOY_PYTHON.md)
- **部署脚本**: [`deploy-python.sh`](deploy-python.sh)
- **同步脚本**: [`sync-to-server-python.ps1`](sync-to-server-python.ps1)

---

## 🎯 部署检查清单

- [ ] SSH 可以连接到服务器
- [ ] 代码已同步到服务器
- [ ] Python 环境已安装
- [ ] 后端服务正常运行（`sudo systemctl status frameworker`）
- [ ] Nginx 正常运行（`sudo systemctl status nginx`）
- [ ] API 健康检查通过（`curl http://localhost:3000/api/health`）
- [ ] 前端页面可以访问（http://149.88.69.87）
- [ ] .env 文件已配置 API 密钥
- [ ] （可选）SSL 证书已安装

---

**预计部署时间**: 5-10 分钟  
**技术支持**: 查看详细日志和错误信息